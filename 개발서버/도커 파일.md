### 도커 파일

------

**개발한 애플리케이션을 컨테이너화 할 때** 

1. 아무것도 존재하지 않는 이미지(우분투, CentOS 등)로 컨테이너를 생성
2. 애플리케이션을 위한 환경을 설치하고 소스코드 등을 복사해 잘 동작하는 것을 확인
3. 컨테이너를 이미지로 커밋

![img](https://blog.kakaocdn.net/dn/esMhAO/btqGGG2xsNY/raLGuA71Z1DeI2zJVk1eR1/img.png)

이 방법을 사용할 경우 애플리케이션이 동작하는 환경을 구성하기 위해 일일이 수작업으로 패키지를 설치하고 소스코드를 깃에서 복제하거나 호스트에서 복제해야 함. -> 이미지의 동작을 보장할 수 있다는 장점

**도커파일로 빌드하는 방법**

완성된 이미지를 생성하기 위해 컨테이너에 설치해야 하는 패키지, 추가해야 하는 소스코드, 실행해야 하는 명령어와 셸 스크립트 등을 하나의 파일에 기록해 두면 도커는 이 파일을 읽어 컨테이너에서 작업을 수행한 뒤 이미지로 만들어 낸다. 

이 작업을 기록한 파일이 Dockerfile이고, 빌드 명령어는 Dockerfile을 읽어 이미지를 생성함.

Dockerfile을 사용하면 직접 컨테이너를 생성하고 이미지로 커밋해야 하는 번거로움을 덜 수 있고, 깃과 같은 개발 도구를 통해 애플리케이션의 빌드 및 배포를 자동화할 수 있다.

Dockerfile은 애플리케이션을 개발하는 용도 외에도 여러 목적으로 사용됨

-> 생성한 이미지를 도커 허브를 통해 배포할 때 이미지 자체를 배포하는 대신 이미지를 생성하는 방법을 기록해 놓은 Dockerfile을 배포할 수도 있음.

-> 배포되는 이미지를 신뢰할 수 없거나 직접 이미지를 생성해서 사용하고 싶을 경우에도 도커 허브에 올려져 있는 Dockerfile로 빌드할 수 있음.

장기적 관점에서 봤을 때는 Dockerfile을 사용하는 것이 유리하다. 



**Dockerfile 작성법**

예:

```
#vi Dockerfile


FROM ubuntu:14.04
MAINTAINER alicek106
LABEL "purpose"="practice"
RUN apt-get update
RUN apt-get install apache2 -y
ADD test.html /var/www/html
WORKDIR /var/www/html
RUN ["/bin/bash", "-c", "echo hello >> test.html"]
EXPOSE 80
CMD apachectl -DFOREGROUND
```

> 도커 엔진은 Dockerfile을 읽어 들일 때 기본적으로 현재 디렉터리에 있는 Dockerfile에 있는 Dockerfile이라는 이름을 가진 파일을 선택한다. Dockerfile은 빈 디렉터리에 저장하는 것이 좋은데, 이는 이미지를 빌드할 때 사용되는 컨텍스트 때문

Dockerfile은 한 줄이 하나의 명령어가 되고, 명령어(Instruction)를 명시한 뒤에 옵션을 추가하는 방식. 명령어는 소문자로 표기해도 상관없지만 일반적으로 대문자로 표기함.

Dockerfile의 명령어는 위에서 아래로 한 줄씩 차례대로 실행됨

* FROM: 생성할 이미지의 베이스가 될 이미지, FROM 명령어는 Dockerfile을 작성할 때 반드시 한 번 이상 입력해야 함

* MAINTAINER: 이미지를 생성한 개발자의 정보를 나타냄. 일반적으로는 도커파일 작성자의 이메일을 적는다. LABEL로 교체해서 표현할 수 있다. 

  ```
  LABEL maintainer "lucyk <kyungju620@gmail.com>"
  ```

* LABE: 이미지에 메타데이터 추가. 메타데이터는 '키:값'의 형태로 저장되며, 여러 개의 메타데이터가 저장될 수 있음. 추가된 메타데이터는 docker inspect 명령어로 이미지의 정보를 구해서 확인 가능.

* RUN: 이미지를 만들기 위해 컨테이너 내부에서 명령어를 실행한다. Dockerfile을 이미지로 빌드하는 과정에서는 별도의 입력이 불가능하므로 별도의 입력이 불가능하므로 설치할 것인지를 선택하는 Y/N을 YES로 설정해야 한다. 이미지를 빌드할 때 별도의 입력을 받아야 하는 명령어가 있으면 오류로 간주한다. 

형태 : 

```
RUN ["실행 가능한 파일", "명령줄 인자 1", "명령줄 인자 2", ... ]
```

JSON 배열의 입력 형식을 따르기 때문에 JSON 형식과 일치해야 한다. 

* ADD: 파일을 이미지에 추가. 추가하는 파일은 Dockerfile이 위치한 디렉터리인 컨텍스트(Context) 에서 가져온다. (Dockerfile이 위치한 디렉토리에서 파일을 가져온다.)

형태 :

```
ADD ["추가할 파일 이름", ... "컨테이너에 추가될 위치"]
```

와 같이 사용할 수 있음. 추가할 파일명은 여러 개를 지정할 수 있으며 배열의 마지막 원소가 컨테이너에 추가될 위치임.

* WORKDIR: 명령어를 실행할 디렉토리. 배시 셸에서 cd 명령어를 입력하는 것과 같은 기능. 

WORKDIR 명령어를 여러 번 사용하면 cd 명령어를 여러 번 사용한 것과 같음. 

```
WORKDIR /var
WORKDIR www/html
```

= WORKDIR /var/www/html

* EXPOSE: Dockerfile의 빌드로 생성된 이미지에서 노출할 포트를 설정함. EXPOSE를 설정한 이미지로 컨테이너를 설정했다고 해서 반드시 이 포트가 호스트의 포트와 바인딩되는 것은 아니며, 단지 컨테이너의 80번 포트를 사용할 것임을 나타내는 것. EXPOSE는 컨테이너를 생성하는 run 명령어에서 모든 노출된 컨테이너의 포트를 호스트에 퍼블리시(Publish)하는 -P 플래그(flag)와 함께 사용됨.
* CMD: CMD는 컨테이너가 시작될 때마다 실행할 명령어(커맨드)를 설정하며, Dockerfile에서 한 번만 사용 가능. 

