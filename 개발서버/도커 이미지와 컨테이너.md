## 도커 이미지와 컨테이너

------

<도커 이미지>

이미지 이름 : [저장소 이름]/[이미지 이름]:[태그]

예: alicek106/ubuntu:14.04

* **저장소 이름**은 이미지가 저장된 장소를 의미, 이미지 생성 시 저장소 이름을 명시할 필요는 없으므로 생략 가능
* **이미지 이름**은 해당 이미지가 어떤 역할을 하는지 나타냄. 이미지 이름은 생략 불가능 반드시 명시해야함
* **태그**는 이미지의 버전 관리, 혹은 리비전 관리에 사용됨, 생략시 latest

<도커 컨테이너>

이미지로 컨테이너 생성 시 해당 이미지의 목적에 맞는 파일이 들어 있는 파일시스템과 격리된 시스템 자원 및 네트워크를 사용할 수 있는 독립된 공간이 생성되고, 이것이 도커 컨테이너

예: 웹 서버 도커 이미지로부터 여러 개의 컨테이너를 생성하면 생성된 컨테이너 개수만큼 웹 서버가 생성되고, 이 컨테이너들은 외부에 웹서비스를 제공하는데 사용될 것

각 컨테이너는 서로 독립된 환경이므로 서로 영향을 주지 않고, 호스트에도 영향 없음

<명령어 정리>

```bash
docker run -i -t ubuntu:14.04
```

docker run : 컨테이너 생성 및 실행

-i -t : 컨테이너와 상호입출력

docker run 에서 -i와 -t 둘 중 하나라도 사용하지 않으면 셸 사용 불가능

```
docker pull centos:7 
```

: 도커 이미지를 내려받을 때 

exit 또는 Ctrl+D : 컨테이너를 정지하면서 컨테이너에서 빠져나오기

Ctrl + P, Q : 컨테이너의 셸에서만 빠져나오기

```
docker create -i -t --name mycentos centos:7 
```

​    :  docker run과 달리 컨테이너 생성만 하고 내부로는 들어가지 않는 명령어

이럴 때는 docker start(컨테이너 시작)와 docker attach(컨테이너 내부로)를 써서 컨테이너를 시작하고 내부로 들어간다

```
docker start mycentos
```

```
docker attach mycentos
```

팁 : 컨테이너 대상 모든 명령어는 컨테이너 이름(centos7같은) 대신 id를 쓰는 것도 가능한데, 너무 길기 때문에 앞에 2~3자만 입력해도 된다

```
docker ps
```

: 생성된 컨테이너 목록 확인

-a 옵션을 주면 꺼진 것도 보여준다

```
docker inspect mycentos | grep Id
```

: 컨테이너 정보를 확인하기 위한 docker inspect (전체 id 확인 가능)

docker ps 했을 때 나오는 정보 보는 법

* CREATED : 컨테이너가 생성되고 난 뒤 흐른 시간을 보여줌
* STATUS : 컨테이너의 상태를 나타냄, 컨테이너가 실행중이면 'Up', 종료됐으면 'Exited', 일시 중지면 'Pause'
* PORTS : 컨테이너가 개방한 포트와 호스트에 연결된 포트를 나열함 외부에 노출하도록 설정하지 않았을 시 아무것도 출력되지 않음
* NAMES :  컨테이너의 고유한 이름 --name 옵션으로 설정하지 않을 시 도커 엔진이 아무거나 만듬 rename으로 변경 가능

```
docker rename angry_morse my_container
```

```
docker ps --format "table {{.ID}}\t{{.Status}}\t{{.Image}}"\t{{.Names}}"
```

: docker ps 테이블에서 원하는 정보만 tab으로 예쁘게 보여주는 명령어

```
docker rm mycentos [컨테이너 이름]
```

: 도커 컨테이너 삭제 명령어 (주의! 실행 중인 컨테이너는 삭제 불가능, 정지하고 삭제 해야함)

```
docker rm -f mycentos
```

: 실행중인 컨테이너도 삭제해준다

```
docker container prune
```

: 전체 컨테이너 삭제

-a 옵션: 컨테이너 상태와 관계없이 모든 컨테이너

-q 옵션: 컨테이너의 ID만 출력하는 역할

docker run 명령어 옵션

-d, -e, --link

-i -t 옵션으로 run을 실행할 경우 표준 입출력이 활성화된, 상호작용이 가능한 셸 환경을 사용할 수 있다. 대부분의 기본 이미지들은 컨테이너 시작시 /bin/bash를 커맨드로 설정해 실행함으로써 배시 셸을 쓸 수 있게 설정한다. 

-d 옵션으로 run을 실행시 입출력이 없는 상태로 컨테이너를 실행함. 컨테이너 내부에서 프로그램이 터미널을 차지하는 포그라운드로 실행돼 사용자의 입력을 받지 않는다. Detached 모드인 컨테이너는 반드시 컨테이너에서 프로그램이 실행돼야 하며, 포그라운드 프로그램이 실행되지 않을 시 컨테이너는 종료된다. 

-e 옵션 : e 옵션은 컨테이너 내부의 환경변수를 설정한다. 컨테이너화된 애플리케이션은 환경변수에서 값을 가져와 쓰는 경우가 많으므로 자주 사용하는 옵션 중 하나. 

ex.

```
docker run -i -t \
--name mysql_attach_test \ 
-e MYSQL_ROOT_PASSWORD=password \
-e MYSQL_DATABASE=wordpress \
mysql:5.7
```

리눅스에서 환경변수 보는 법

```
echo ${ENVIRONMENT_NAME}
```

